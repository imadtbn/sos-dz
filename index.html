<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الطوارئ والنجدة في الجزائر</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        :root {
            --primary: #e63946;
            --secondary: #1d3557;
            --accent: #457b9d;
            --light: #f1faee;
            --warning: #ff9e00;
            --success: #2a9d8f;
        }

        :root {
            --pharmacy-color: #2e7d32;
            /* أخضر طبي */
            --laboratory-color: #6a1b9a;
            /* بنفسجي علمي */
            --hospital-color: #1565c0;
            /* أزرق صحي */
            --civil-defense-color: #d32f2f;
            /* أحمر طوارئ */
            --police-color: #2f13d1;
            /* أحمر طوارئ */

            --service-bg: #ffffff;
            --service-border-radius: 14px;
        }

        .service-card {
            background: var(--service-bg);
            border-radius: var(--service-border-radius);
            transition: 0.3s ease;
        }

        /* صيدليات */
        .service-card.pharmacy {
            border-right: 5px solid var(--pharmacy-color);
        }

        /* مخابر */
        .service-card.laboratory {
            border-right: 5px solid var(--laboratory-color);
        }

        /* مستشفيات */
        .service-card.hospital {
            border-right: 5px solid var(--hospital-color);
        }

        /* حماية مدنية */
        .service-card.civil {
            border-right: 5px solid var(--civil-defense-color);
        }

        /* الشرطة */
        .service-card.civil {
            border-right: 5px solid var(--police-color);
        }

        .service-card.pharmacy .service-icon i {
            color: var(--pharmacy-color);
        }

        .service-card.laboratory .service-icon i {
            color: var(--laboratory-color);
        }

        .service-card.hospital .service-icon i {
            color: var(--hospital-color);
        }

        .service-card.civil .service-icon i {
            color: var(--civil-defense-color);
        }

        .service-police .service-icon i {
            color: var(--police-color);
        }

        .service-item.nearest {
            background: rgba(0, 0, 0, 0.04);
            border-right: 4px solid currentColor;
            font-weight: bold;
        }

        .service-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }


        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        body {
            padding-top: 78px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            z-index: 1000;
            transition: transform 0.3s ease-in-out;
        }


        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 2.2rem;
            color: var(--primary);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .emergency-contact {
            background-color: var(--primary);
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 8px rgba(230, 57, 70, 0.4);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(29, 53, 87, 0.9), rgba(69, 123, 157, 0.9)), url('https://images.unsplash.com/photo-1582719508461-905c673771fd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: rgb(255, 255, 255);
            padding: 3rem 0;
            text-align: center;
        }

        .hero h2 {
            font-size: 2.2rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto 1.5rem;
        }

        .location-access {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-secondary {
            background-color: var(--accent);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 2rem 0;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Map Section */
        .map-section {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .section-header {
            background-color: var(--secondary);
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #map {
            height: 500px;
            width: 100%;
        }

        /* Services Section */
        .services {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .service-card {
            background-color: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-5px);
        }

        .service-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .service-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .service-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .hospital .service-icon {
            background-color: var(--primary);
        }

        .police .service-icon {
            background-color: var(--secondary);
        }

        .military .service-icon {
            background-color: #555;
        }

        .civil-defense .service-icon {
            background-color: var(--warning);
        }

        .service-phone {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .service-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #eee;
        }

        .service-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .service-item:last-child {
            border-bottom: none;
        }

        .distance {
            color: var(--success);
            font-weight: 700;
        }

        /* Emergency Numbers */
        .emergency-numbers {
            background-color: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-top: 2rem;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 1.5rem;
        }

        .number-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1rem;
            border-radius: 10px;
            border-right: 5px solid var(--primary);
        }

        .number-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .number-card p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            direction: ltr;
        }

        /* Footer */
        footer {
            background-color: var(--secondary);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
            text-align: center;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            margin-top: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-links a {
            color: #ddd;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
            text-decoration: underline;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            border-radius: 12px;
            overflow: hidden;
        }

        .modal-header {
            background-color: var(--secondary);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .route-info {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .route-steps {
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .route-step {
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            gap: 10px;
        }

        .route-step i {
            color: var(--accent);
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .hero h2 {
                font-size: 1.8rem;
            }
        }

        @media (max-width: 576px) {
            .location-access {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Loading spinner */
        .spinner {
            display: none;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /*....زر الطوارئ عائم*/
        .floating-emergency {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: #e63946;
            color: white;
            border: none;
            font-size: 22px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: 0.3s;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .phone-link {
            text-decoration: none;
            color: #e63946;
            /* نفس لون الطوارئ في الموقع */
            font-weight: 700;
            font-size: 1.4rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .phone-link i {
            font-size: 1rem;
        }


        .call-link {
            text-decoration: none;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .call-link:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .phone-number {
            font-weight: 700;
            font-size: 1.1rem;
            direction: ltr;
        }


        /* نفس لون الطوارئ في Emergency Numbers */

        .call-link-Emergency {
            text-decoration: none;
            color: rgb(235, 9, 9);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .phone-number-Emergency {
            font-weight: 700;
            font-size: 1.3rem;
            direction: ltr;
        }


        .messenger-link {
            text-decoration: none;
            color: #0084FF;
            /* لون ماسنجر الرسمي */
            font-weight: 700;
            font-size: 1.2rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .messenger-link:hover {
            opacity: 0.85;
        }

        .floating-wrapper {
            position: fixed;
            bottom: 25px;
            left: 25px;
            z-index: 9999;
        }


        .floating-emergency:hover {
            transform: scale(1.1);
        }

        .emergency-menu {
            position: absolute;
            bottom: 80px;
            left: 0;
            display: none;
            flex-direction: column;
            gap: 10px;
        }

        .emergency-menu a {
            background: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            transition: 0.2s;
        }

        .emergency-menu a:hover {
            background: #e63946;
            color: white;
        }

        .google-route-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: #1a73e8;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
        }

        .google-route-btn:hover {
            background: #1558b0;
            transform: translateY(-2px);
        }

        .modern-modal {
            border-radius: 16px;
            overflow: hidden;
        }

        .modal-header {
            background: #1d3557;
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-modal {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
        }

        .close-modal:hover {
            background: #e63946;
            transform: rotate(90deg);
        }

        .destination-image img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .google-route-btn {
            display: block;
            text-align: center;
            background: #1a73e8;
            color: white;
            padding: 14px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 700;
            margin-top: 15px;
            transition: 0.3s;
        }

        .google-route-btn:hover {
            background: #1558b0;
        }

        .mini-map-container {
            margin: 15px 0;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #ddd;
        }

        #miniMap {
            height: 250px;
            width: 100%;
        }

        .google-route-btn {
            display: inline-block;
            margin-top: 12px;
            padding: 10px 18px;
            background: #1a73e8;
            color: #fff;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
        }

        header {
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            z-index: 1000;
            transition: transform 0.3s ease-in-out;
        }

        header.hide-header {
            transform: translateY(-100%);
        }

        /* أول عنصر (الأقرب) يكون مميز بصريًا */

        .service-item.nearest {
            background: #f1faee;
            border-right: 4px solid var(--success);
            padding-right: 10px;
            font-weight: 700;
        }

        .service-item.nearest .distance {
            color: var(--primary);
            font-size: 1.05rem;
        }

        .nearest-marker i {
            animation: pulse-marker 1.5s infinite;
        }

        @keyframes pulse-marker {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .service-item {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .service-item:hover {
            background: #f8f9fa;
            transform: translateX(-4px);
        }


        /* تأثير نبض على أرقام الطوارئ */
        .phone-number-Emergency {
            font-weight: 700;
            font-size: 1.3rem;
            direction: ltr;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .number-card:hover .phone-number-Emergency {
            color: #ff4d4d;
            /* لون جذاب عند المرور */
            transform: scale(1.2);
            /* تكبير الرقم قليلاً */
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.6);
        }

        /* نبض مستمر */
        @keyframes pulseNumber {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.15);
            }

            100% {
                transform: scale(1);
            }
        }

        .number-card.important .phone-number-Emergency {
            animation: pulseNumber 1.5s infinite;
        }


        /* تأثير نبض لأرقام الطوارئ */
        @keyframes pulse-card {
            0% {
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(230, 57, 70, 0.3);
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 10px 25px rgba(230, 57, 70, 0.5);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(230, 57, 70, 0.3);
            }
        }

        /* تطبيق النبض */
        .number-card.pulse {
            animation: pulse-card 1.5s infinite;
        }

        .pharmacy-marker {
            background: transparent;
            border: none;
        }

        .pharmacy-marker i {
            display: block;
            line-height: 20px;
            text-align: center;
        }


        .leaflet-div-icon {
            background: transparent;
            border: none;
        }
    </style>

</head>

<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-crosshairs"></i>
                <h1>الطوارئ والنجدة في الجزائر</h1>
            </div>
            <!--             <a href="tel:1021" class="emergency-contact call-link">
                <img src="icons/dgpc.svg" alt="logo dgpc" width="24" height="24" loading="lazy">
                <span></span>
                <span class="phone-number"></span>
                <i class="fas fa-phone"></i>
            </a>
         
          -->
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>خدمات الطوارئ والنجدة في الجزائر</h2>
            <p>في حالة الطوارئ، حدد موقعك للحصول على أقرب مستشفى، مركز شرطة، فرقة الدرك الوطني أو وحدة الحماية المدنية
                مع أرقام الهاتف
                وإمكانية تكوين المسارات</p>

            <div class="location-access">
                <button id="getLocation" class="btn btn-primary">
                    <i class="fas fa-map-marker-alt"></i>
                    تحديد موقعي الحالي
                </button>
                <button id="showAllServices" class="btn btn-secondary">
                    <i class="fas fa-hospital-alt"></i>
                    عرض جميع مراكز الخدمات
                </button>

                <!--                 
                <button id="emergencyCall" class="btn btn-warning">
                    <i class="fas fa-phone"></i>
                    اتصال طوارئ
                </button>
                 -->
            </div>

            <div id="locationStatus" style="margin-top: 15px; color: #ffdddd; font-weight: 700;"></div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <div class="main-content">
            <!-- Map Section -->
            <div class="map-section">
                <div class="section-header">
                    <i class="fas fa-map"></i>
                    <h3>الخريطة التفاعلية</h3>
                </div>
                <div id="map"></div>
            </div>

            <!-- Services Section -->
            <div class="services">

                <div class="service-card hospital">
                    <div class="service-header">
                        <div class="service-title">
                            <div class="service-icon">
                                <i class="fas fa-hospital"></i>
                            </div>
                            <h3>المستشفيات</h3>
                        </div>
                    </div>
                    <div class="service-details">
                        <div id="hospitalsList">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                            <p>اضغط على "تحديد موقعي" لعرض أقرب المستشفيات</p>
                        </div>
                    </div>
                </div>

                <div class="service-card police">
                    <div class="service-header">
                        <div class="service-title">
                            <div class="service-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>مراكز الشرطة</h3>
                        </div>
                    </div>
                    <div class="service-details">
                        <div id="policeList">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                            <p>اضغط على "تحديد موقعي" لعرض أقرب مراكز الشرطة</p>
                        </div>
                    </div>
                </div>

                <div class="service-card military">
                    <div class="service-header">
                        <div class="service-title">
                            <div class="service-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <h3>فرق الدرك الوطني</h3>
                        </div>
                    </div>
                    <div class="service-details">
                        <div id="militaryList">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                            <p>اضغط على "تحديد موقعي" لعرض أقرب فرقة للدرك الوطني</p>
                        </div>
                    </div>
                </div>

                <div class="service-card civil-defense">
                    <div class="service-header">
                        <div class="service-title">
                            <div class="service-icon">
                                <i class="fas fa-fire-extinguisher"></i>
                            </div>
                            <h3>وحدات الحماية المدنية</h3>
                        </div>

                    </div>
                    <div class="service-details">
                        <div id="civilDefenseList">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                            <p>اضغط على "تحديد موقعي" لعرض أقرب وحدات الحماية المدنية
                        </div>
                    </div>
                </div>

                <div class="service-card pharmacy">
                    <div class="service-header">

                        <div class="service-title">
                            <div class="service-icon">
                                <i class="fas fa-capsules"></i>
                                <i class="fas fa-mortar-pestle"></i>
                            </div>
                            <h3>صيدليات</h3>
                        </div>

                    </div>

                    <div class="service-details">
                        <div id="pharmacyList">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                            <p>اضغط على "تحديد موقعي" لعرض أقرب الصيدليات</p>
                        </div>
                    </div>

                </div>

                <div class="service-card laboratory">
                    <div class="service-header">
                        <div class="service-title">
                            <div class="service-icon">
                                <i class="fas fa-flask"></i>


                            </div>
                            <h3>مخابر التحاليل البيولوجية</h3>
                        </div>
                    </div>

                    <div class="service-details">
                        <div id="laboratoryList">
                            <p>اضغط على "تحديد موقعي" لعرض أقرب مخابر التحاليل البيولوجية</p>
                        </div>
                    </div>
                </div>



            </div>
        </div>

        <!-- Emergency Numbers -->
        <div class="emergency-numbers">
            <div class="section-header">
                <h3>أرقام الطوارئ الهامة</h3>
                <i class="fas fa-phone"></i>
            </div>

            <div class="numbers-grid">

                <div class="number-card pulse">
                    <h4>
                        <img src="icons/dgpc.svg" alt="logo dgpc" width="31" height="32" loading="lazy">
                        الحماية المدنية
                    </h4>

                    <p>
                        <a href="tel:121" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">1021</span>
                        </a>
                    </p>
                </div>


                <div class="number-card">
                    <h4>
                        <img src="icons/CGN.jpg" alt="logo CGN" width="31" height="32" loading="lazy">
                        الدرك الوطني
                    </h4>

                    <p>
                        <a href="tel:1055" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">1055</span>
                        </a>
                    </p>
                </div>

                <div class="number-card">
                    <h4>
                        <img src="icons/tariki.jpg" alt="logo tariki" width="31" height="32" loading="lazy">
                        مركز الإعلام والتنسيق المروري - طريقي - عبر المسنجر
                    </h4>

                    <p>
                        <a href="https://www.facebook.com/messages/t/402215187257085?locale=ar_AR" target="_blank"
                            class="messenger-link">
                            <i class="fab fa-facebook-messenger"></i>
                            <span class="phone-number-Emergency">طريقي</span>
                        </a>
                    </p>
                </div>

                <div class="number-card">
                    <h4>
                        <img src="icons/CFN.png" alt="logo cfa" width="31" height="32" loading="lazy">
                        حرس السواحل
                    </h4>

                    <p>
                        <a href="tel:1054" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">1054</span>
                        </a>
                    </p>
                </div>

                <div class="number-card">
                    <h4>
                        <img src="icons/dgsn.png" alt="logo dgsn" width="31" height="32" loading="lazy">
                        الشرطة الجزائرية
                    </h4>

                    <p>
                        <a href="tel:1548" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">1548</span>
                        </a>
                    </p>
                </div>

                <div class="number-card">
                    <h4>
                        <img src="icons/gosp.jpg" alt="logo gosp" width="31" height="32" loading="lazy">
                        فرقة جمهرة العمليات الخاصة للشرطة الجزائرية
                    </h4>

                    <p>
                        <a href="tel:104" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">104</span>
                        </a>
                    </p>
                </div>



                <div class="number-card">
                    <h4>
                        <img src="icons/sonelgaz.png" alt="logo sonelgaz" width="31" height="32" loading="lazy">
                        الكهرباء والغاز
                    </h4>

                    <p>
                        <a href="tel:3030" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">3030</span>
                        </a>
                    </p>
                </div>

                <div class="number-card">
                    <h4>
                        <img src="icons/ade.png" alt="logo ade" width="31" height="32" loading="lazy">
                        الجزائرية للمياه
                    </h4>

                    <p>
                        <a href="tel:1593" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">1593</span>
                        </a>
                    </p>
                </div>

                <div class="number-card">
                    <h4>
                        <img src="icons/seaal.webp" alt="logo seaal" width="31" height="32" loading="lazy">
                        سيال للتطهير والمياه
                    </h4>

                    <p>
                        <a href="tel:1594" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">1594</span>
                        </a>
                    </p>
                </div>


                <div class="number-card">
                    <h4>
                        <img src="icons/naftal.webp" alt="logo naftal" width="31" height="32" loading="lazy">
                        نفطال للمحروقات والوقود
                    </h4>

                    <p>
                        <a href="tel:3305" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">3305</span>
                        </a>
                    </p>
                </div>




                <div class="number-card">
                    <h4>
                        <img src="icons/DGF.png" alt="logo DGF" width="31" height="32" loading="lazy">
                        المديرية العامة للغابات
                    </h4>

                    <p>
                        <a href="tel:1070" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">1070</span>
                        </a>
                    </p>
                </div>


                <div class="number-card">
                    <h4>
                        <img src="icons/pasteur.jpg" alt="logo naftal" width="31" height="32" loading="lazy">
                        معهد باستور - الجزائر
                    </h4>

                    <p>
                        <a href="tel:+21323367504" class="call-link-Emergency">
                            <i class="fas fa-phone"></i>
                            <span class="phone-number-Emergency">+21323367504</span>
                        </a>
                    </p>
                </div>

            </div>
        </div>

    </div>

    <!-- Route Modal -->
    <div id="routeModal" class="modal">
        <div class="modal-content modern-modal">
            <div class="modal-header">
                <h3 id="routeTitle">تفاصيل المسار</h3>
                <button class="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="mini-map-container">
                    <div id="miniMap"></div>
                </div>

                <div id="routeDetails" class="route-info"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="logo">
                <i class="fas fa-crosshairs"></i>
                <h2>الطوارئ والنجدة في الجزائر</h2>
            </div>
            <p>خدمة وطنية لتحديد مواقع خدمات الطوارئ في جميع أنحاء الجزائر</p>
            <div class="footer-links">
                <a href="#">عن الموقع</a>
                <a href="#">اتصل بنا</a>
                <a href="#">سياسة الخصوصية</a>
                <a href="#">الإرشادات</a>
            </div>
            <p>جميع الحقوق محفوظة &copy; 2023</p>
        </div>
    </footer>

    <!-- زر الطوارئ العائم -->
    <div class="floating-wrapper">

        <button id="emergencyToggle" class="floating-emergency">
            <i class="fas fa-phone"></i>
        </button>

        <div id="emergencyMenu" class="emergency-menu">
            <a href="tel:1021"><img src="icons/dgpc.svg" alt="logo dgpc" width="22" height="22" loading="lazy"></i>
                الحماية المدنية</a>
            <a href="tel:1548"><img src="icons/dgsn.png" alt="logo dgsn" width="22" height="22" loading="lazy"></i>
                الشرطة</a>
            <a href="tel:1055"><img src="icons/CGN.jpg" alt="logo cgn" width="22" height="22" loading="lazy"></i> الدرك
                الوطني</a>
            <a href="tel:1054"><img src="icons/CFN.png" alt="logo CFN" width="22" height="22" loading="lazy">
                </i>حرس السواحل</a>
        </div>

    </div>


    <!-- JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // تهيئة الخريطة
        let map = L.map('map').setView([36.7525, 3.0418], 10); // إحداثيات الجزائر العاصمة
        let userMarker = null;
        let userLocation = null;
        let miniMap = null;
        let miniMarker = null;
        let miniRouteLine = null;

        // إضافة طبقة الخريطة
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // بيانات وهمية لمراكز الخدمات في الجزائر
        const serviceLocations = {
            hospitals: [
                { name: "مستشفى مصطفى باشا", lat: 36.7516, lng: 3.0588, phone: "023 41 41 41", address: "الجزائر العاصمة" },
                { name: "مستشفى بني مسوس", lat: 36.7350, lng: 3.0150, phone: "023 41 42 42", address: "بني مسوس، الجزائر" },
                { name: "مستشفى الدويرة", lat: 36.7222, lng: 3.2097, phone: "023 41 43 43", address: "الدويرة، الجزائر" },
                { name: "مستشفى باب الواد", lat: 36.7892, lng: 3.0575, phone: "023 41 44 44", address: "باب الواد، الجزائر" }
            ],
            police: [
                { name: "مركز الشرطة - القبة", lat: 36.7392, lng: 3.0708, phone: "017 71 71 71", address: "القبة، الجزائر" },
                { name: "مركز الشرطة - الحراش", lat: 36.7064, lng: 3.1808, phone: "017 71 72 72", address: "الحراش، الجزائر" },
                { name: "مركز الشرطة - بولوغين", lat: 36.7553, lng: 2.9975, phone: "017 71 73 73", address: "بولوغين، الجزائر" }
            ],
            military: [
                { name: "فرقة الدرك - بني مسوس", lat: 36.7281, lng: 3.0281, phone: "021 71 15 15", address: "بني مسوس، الجزائر" },
                { name: "فرقة الدرك - الحراش", lat: 36.7153, lng: 3.1667, phone: "021 71 16 16", address: "الحراش، الجزائر" }
            ],
            civilDefense: [
                { name: "وحدة الحماية المدنية - القبة", lat: 36.7469, lng: 3.0764, phone: "014 14 14 14", address: "القبة، الجزائر" },
                { name: "وحدة الحماية المدنية - باب الواد", lat: 36.7950, lng: 3.0500, phone: "014 14 14 15", address: "باب الواد، الجزائر" },
                { name: "وحدة الحماية المدنية - الدويرة", lat: 36.7167, lng: 3.2000, phone: "014 14 14 16", address: "الدويرة، الجزائر" }
            ],
            pharmacy: [
                { name: "صيدلية الشفاء", lat: 36.7538, lng: 3.0588, phone: "023 41 41 41", address: "الجزائر العاصمة" },
                { name: "صيدلية الحياة", lat: 36.7550, lng: 3.0600, phone: "023 41 42 42", address: "بني مسوس، الجزائر" },
                { name: "مستشفى الدويرة", lat: 36.7222, lng: 3.2097, phone: "023 41 43 43", address: "الدويرة، الجزائر" },
                { name: "صيدلية الأمل", lat: 36.7510, lng: 3.0550, phone: "023 41 44 44", address: "باب الواد، الجزائر" }
            ],
            Laboratory: [
                { name: "مختبر النور", lat: 36.7538, lng: 3.0588, phone: "023 41 41 41", address: "الجزائر العاصمة" },
                { name: "مختبر المستقبل", lat: 36.7550, lng: 3.0600, phone: "023 41 42 42", address: "بني مسوس، الجزائر" },
                { name: "مختبر بومرداس", lat: 36.7222, lng: 3.2097, phone: "023 41 43 43", address: "الدويرة، الجزائر" },
                { name: "مختبر التحاليل البيولوجية", lat: 36.7510, lng: 3.0550, phone: "023 41 44 44", address: "باب الواد، الجزائر" }
            ]
        };

        // وظيفة حساب المسافة بين نقطتين (صيغة هافرسين)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // نصف قطر الأرض بالكيلومترات
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        // Reverse Geocoding  تحويل الإحداثيات إلى اسم مدينة / ولاية / دولة
        async function getAddressFromCoordinates(lat, lng) {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ar`
                );

                const data = await response.json();

                if (data && data.address) {
                    const city =
                        data.address.city ||
                        data.address.town ||
                        data.address.village ||
                        data.address.municipality ||
                        '';

                    const state = data.address.state || '';
                    const country = data.address.country || '';

                    return [city, state, country].filter(Boolean).join('، ');
                }

                return '';
            } catch (error) {
                console.error('خطأ في جلب اسم الموقع:', error);
                return '';
            }
        }


        // وظيفة لتحديد أقرب الخدمات
        function findNearestServices(userLat, userLng) {
            const nearestServices = {
                hospitals: [],
                police: [],
                military: [],
                civilDefense: [],
                pharmacy: [],
                Laboratory: []
            };

            // لكل نوع خدمة، نحسب المسافة ونرتبها
            for (const serviceType in serviceLocations) {
                const services = serviceLocations[serviceType].map(service => {
                    const distance = calculateDistance(userLat, userLng, service.lat, service.lng);
                    return { ...service, distance };
                });

                // ترتيب حسب المسافة (الأقرب أولاً)
                services.sort((a, b) => a.distance - b.distance);

                // أخذ أقرب 3 خدمات
                nearestServices[serviceType] = services.slice(0, 3);
            }

            return nearestServices;
        }

        // وظيفة لعرض الخدمات في القوائم
        function displayServices(services) {

            const hospitalsList = document.getElementById('hospitalsList');
            const policeList = document.getElementById('policeList');
            const militaryList = document.getElementById('militaryList');
            const civilDefenseList = document.getElementById('civilDefenseList');
            const pharmacyList = document.getElementById('pharmacyList');
            const LaboratoryList = document.getElementById('LaboratoryList');


            hospitalsList.innerHTML = '';
            policeList.innerHTML = '';
            militaryList.innerHTML = '';
            civilDefenseList.innerHTML = '';
            pharmacyList.innerHTML = '';
            LaboratoryList.innerHTML = '';

            // المستشفيات
            services.hospitals.forEach((hospital, index) => {
                const item = document.createElement('div');
                item.className = 'service-item';

                if (index === 0) {
                    item.classList.add('nearest');
                }

                item.innerHTML = `
        <span>${hospital.name}</span>
        <span class="distance">${hospital.distance.toFixed(1)} كم</span>
    `;

                item.addEventListener('click', () => showRouteToService(hospital));
                hospitalsList.appendChild(item);
            });

            // الشرطة
            services.police.forEach((police, index) => {
                const item = document.createElement('div');
                item.className = 'service-item';

                if (index === 0) {
                    item.classList.add('nearest');
                }

                item.innerHTML = `
        <span>${police.name}</span>
        <span class="distance">${police.distance.toFixed(1)} كم</span>
    `;

                item.addEventListener('click', () => showRouteToService(police));
                policeList.appendChild(item);
            });

            // الدرك
            services.military.forEach((military, index) => {
                const item = document.createElement('div');
                item.className = 'service-item';

                if (index === 0) {
                    item.classList.add('nearest');
                }

                item.innerHTML = `
        <span>${military.name}</span>
        <span class="distance">${military.distance.toFixed(1)} كم</span>
    `;

                item.addEventListener('click', () => showRouteToService(military));
                militaryList.appendChild(item);
            });

            // الحماية المدنية
            services.civilDefense.forEach((civil, index) => {
                const item = document.createElement('div');
                item.className = 'service-item';

                if (index === 0) {
                    item.classList.add('nearest'); // تمييز الأقرب
                }

                item.innerHTML = `
        <span>${civil.name}</span>
        <span class="distance">${civil.distance.toFixed(1)} كم</span>
    `;
                item.addEventListener('click', () => showRouteToService(civil));
                civilDefenseList.appendChild(item);
            });

            // صيدليات
            services.pharmacy.forEach((pharmacy, index) => {
                const item = document.createElement('div');
                item.className = 'service-item';

                if (index === 0) {
                    item.classList.add('nearest');
                }

                item.innerHTML = `
        <span>${pharmacy.name}</span>
        <span class="distance">${pharmacy.distance.toFixed(1)} كم</span>
    `;

                item.addEventListener('click', () => showRouteToService(pharmacy));
                pharmacyList.appendChild(item);
            });

            // مختبرات
            services.Laboratory.forEach((Laboratory, index) => {
                const item = document.createElement('div');
                item.className = 'service-item';

                if (index === 0) {
                    item.classList.add('nearest');
                }

                item.innerHTML = `
        <span>${Laboratory.name}</span>
        <span class="distance">${Laboratory.distance.toFixed(1)} كم</span>
    `;

                item.addEventListener('click', () => showRouteToService(Laboratory));
                LaboratoryList.appendChild(item);
            });

        }

        // وظيفة إضافة العلامات على الخريطة
        function addMarkersToMap(services) {

            // إزالة العلامات القديمة ما عدا علامة المستخدم
            map.eachLayer(layer => {
                if (layer instanceof L.Marker && layer !== userMarker) {
                    map.removeLayer(layer);
                }
            });

            // إضافة علامات للمستشفيات
            services.hospitals.forEach(hospital => {
                L.marker([hospital.lat, hospital.lng], {
                    icon: L.divIcon({
                        html: `<i class="fas fa-hospital" style="color:var(--hospital-color);font-size:20px;"></i>`,
                        iconSize: [20, 20],
                        className: 'hospital-marker'
                    })
                })
                    .addTo(map)
                    .bindPopup(`<b>${hospital.name}</b><br>${hospital.address}<br>الهاتف: ${hospital.phone}<br>المسافة: ${hospital.distance.toFixed(1)} كم`);
            });

            // إضافة علامات لمراكز الشرطة
            services.police.forEach(police => {
                L.marker([police.lat, police.lng], {
                    icon: L.divIcon({
                        html: '<i class="fas fa-shield-alt" style="color: #1d3557; font-size: 20px;"></i>',
                        iconSize: [20, 20],
                        className: 'police-marker'
                    })
                })
                    .addTo(map)
                    .bindPopup(`<b>${police.name}</b><br>${police.address}<br>الهاتف: ${police.phone}<br>المسافة: ${police.distance.toFixed(1)} كم`);
            });

            // إضافة علامات لمراكز الدرك
            services.military.forEach(military => {
                L.marker([military.lat, military.lng], {
                    icon: L.divIcon({
                        html: '<i class="fas fa-star" style="color: #555; font-size: 20px;"></i>',
                        iconSize: [20, 20],
                        className: 'military-marker'
                    })
                })
                    .addTo(map)
                    .bindPopup(`<b>${military.name}</b><br>${military.address}<br>الهاتف: ${military.phone}<br>المسافة: ${military.distance.toFixed(1)} كم`);
            });

            // الحماية المدنية
            services.civilDefense.forEach(civilDefense => {
                L.marker([civilDefense.lat, civilDefense.lng], {
                    icon: L.divIcon({
                        html: `<i class="fas fa-fire-extinguisher" style="color:var(--civil-defense-color);font-size:20px;"></i>`,
                        iconSize: [20, 20],
                        className: 'civil-defense-marker'
                    })
                })
                    .addTo(map)
                    .bindPopup(`<b>${civilDefense.name}</b><br>${civilDefense.address}<br>الهاتف: ${civilDefense.phone}<br>المسافة: ${civilDefense.distance.toFixed(1)} كم`);
            });

            // إضافة علامات للصيدليات
            services.pharmacy.forEach(pharmacy => {
                L.marker([pharmacy.lat, pharmacy.lng], {
                    icon: L.divIcon({
                        html: `<i class="fas fa-capsules" style="color:var(--pharmacy-color);font-size:20px;"></i>`,

                        iconSize: [20, 20],
                        className: 'pharmacy-marker'
                    })
                })
                    .addTo(map)
                    .bindPopup(`<b>${pharmacy.name}</b><br>${pharmacy.address}<br>الهاتف: ${pharmacy.phone}<br>المسافة: ${pharmacy.distance.toFixed(1)} كم`);
            });

            // إضافة علامات للمختبرات البيولوجية
            services.Laboratory.forEach(Laboratory => {
                L.marker([Laboratory.lat, Laboratory.lng], {
                    icon: L.divIcon({
                        html: `<i class="fas fa-vial" style="color:var(--laboratory-color);font-size:20px;"></i>`,
                        iconSize: [20, 20],
                        className: 'Laboratory-marker'
                    })
                })
                    .addTo(map)
                    .bindPopup(`<b>${Laboratory.name}</b><br>${Laboratory.address}<br>الهاتف: ${Laboratory.phone}<br>المسافة: ${Laboratory.distance.toFixed(1)} كم`);
            });

        }

        // وظيفة تحديد موقع المستخدم
        document.getElementById('getLocation').addEventListener('click', () => {

            const status = document.getElementById('locationStatus');
            const button = document.getElementById('getLocation');

            // تعطيل الزر وإظهار التحميل
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري تحديد الموقع...';

            status.textContent = 'جاري تحديد موقعك...';
            status.style.color = '#ffdddd';

            if (navigator.geolocation) {

                navigator.geolocation.getCurrentPosition(

                    (position) => {

                        const userLat = position.coords.latitude;
                        const userLng = position.coords.longitude;
                        userLocation = { lat: userLat, lng: userLng };

                        const coordsText = `تم تحديد موقعك: ${userLat.toFixed(4)}, ${userLng.toFixed(4)}`;
                        status.textContent = coordsText;
                        status.style.color = '#aaffaa';

                        // جلب اسم المدينة
                        getAddressFromCoordinates(userLat, userLng).then(address => {
                            if (address) {
                                status.innerHTML = `
            ${coordsText}<br>
            ${address}
        `;
                            }
                        });


                        if (userMarker) {
                            map.removeLayer(userMarker);
                        }

                        userMarker = L.marker([userLat, userLng], {
                            icon: L.divIcon({
                                html: '<i class="fas fa-user" style="color: #2a9d8f; font-size: 24px;"></i>',
                                iconSize: [24, 24],
                                className: 'user-marker'
                            })
                        }).addTo(map).bindPopup('<b>موقعك الحالي</b>');

                        map.setView([userLat, userLng], 13);

                        const nearestServices = findNearestServices(userLat, userLng);

                        displayServices(nearestServices);
                        addMarkersToMap(nearestServices);

                        // إعادة الزر لوضعه الطبيعي
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-map-marker-alt"></i> تحديد موقعي الحالي';
                    },

                    (error) => {

                        let errorMessage = 'فشل تحديد الموقع. ';

                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += 'تم رفض إذن الموقع.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += 'معلومات الموقع غير متاحة.';
                                break;
                            case error.TIMEOUT:
                                errorMessage += 'انتهت مهلة طلب الموقع.';
                                break;
                            default:
                                errorMessage += 'حدث خطأ غير معروف.';
                        }

                        status.textContent = errorMessage;
                        status.style.color = '#ffaaaa';

                        userLocation = { lat: 36.7525, lng: 3.0418 };

                        const nearestServices = findNearestServices(userLocation.lat, userLocation.lng);
                        displayServices(nearestServices);
                        addMarkersToMap(nearestServices);

                        // إعادة الزر لوضعه الطبيعي
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-map-marker-alt"></i> تحديد موقعي الحالي';
                    }

                );

            } else {

                status.textContent = 'المتصفح لا يدعم تحديد الموقع الجغرافي';
                status.style.color = '#ffaaaa';

                button.disabled = false;
                button.innerHTML = '<i class="fas fa-map-marker-alt"></i> تحديد موقعي الحالي';
            }

        });

        // وظيفة عرض جميع الخدمات
        document.getElementById('showAllServices').addEventListener('click', () => {
            if (!userLocation) {
                alert('الرجاء تحديد موقعك أولاً');
                return;
            }

            // جمع جميع الخدمات
            const allServices = {
                hospitals: serviceLocations.hospitals.map(h => ({
                    ...h,
                    distance: calculateDistance(userLocation.lat, userLocation.lng, h.lat, h.lng)
                })),
                police: serviceLocations.police.map(p => ({
                    ...p,
                    distance: calculateDistance(userLocation.lat, userLocation.lng, p.lat, p.lng)
                })),
                military: serviceLocations.military.map(m => ({
                    ...m,
                    distance: calculateDistance(userLocation.lat, userLocation.lng, m.lat, m.lng)
                })),
                civilDefense: serviceLocations.civilDefense.map(c => ({
                    ...c,
                    distance: calculateDistance(userLocation.lat, userLocation.lng, c.lat, c.lng)
                })),
                pharmacy: serviceLocations.pharmacy.map(h => ({
                    ...h,
                    distance: calculateDistance(userLocation.lat, userLocation.lng, h.lat, h.lng)
                })),
                Laboratory: serviceLocations.Laboratory.map(h => ({
                    ...h,
                    distance: calculateDistance(userLocation.lat, userLocation.lng, h.lat, h.lng)
                })),
            };

            // عرض جميع الخدمات
            displayServices(allServices);

            // إضافة جميع العلامات على الخريطة
            addMarkersToMap(allServices);

            // تكبير الخريطة لتناسب جميع العلامات
            const allPoints = [
                ...allServices.hospitals,
                ...allServices.police,
                ...allServices.military,
                ...allServices.civilDefense,
                ...allServices.pharmacy,
                ...allServices.Laboratory

            ].map(s => [s.lat, s.lng]);

            if (allPoints.length > 0) {
                const bounds = L.latLngBounds(allPoints);
                if (userMarker) {
                    bounds.extend([userLocation.lat, userLocation.lng]);
                }
                map.fitBounds(bounds);
            }
        });

        // وظيفة عرض مسار إلى الخدمة
        function showRouteToService(service) {

            if (!userLocation) {
                alert('الرجاء تحديد موقعك أولاً');
                return;
            }

            const modal = document.getElementById('routeModal');
            const routeTitle = document.getElementById('routeTitle');
            const routeDetails = document.getElementById('routeDetails');

            routeTitle.textContent = service.name;

            const googleMapsUrl =
                `https://www.google.com/maps/dir/?api=1` +
                `&origin=${userLocation.lat},${userLocation.lng}` +
                `&destination=${service.lat},${service.lng}` +
                `&travelmode=driving`;

            routeDetails.innerHTML = `
        <p><strong>العنوان:</strong> ${service.address}</p>
        <p><strong>الهاتف:</strong> ${service.phone}</p>
        <a href="${googleMapsUrl}" target="_blank" class="google-route-btn">
            التنقل عبر Google Maps
        </a>
    `;

            modal.style.display = 'flex';

            setTimeout(() => {

                if (!miniMap) {
                    miniMap = L.map('miniMap', {
                        zoomControl: false,
                        attributionControl: false
                    });
                }

                miniMap.setView([service.lat, service.lng], 14);

                if (!miniMap._layersInitialized) {
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
                        .addTo(miniMap);
                    miniMap._layersInitialized = true;
                }

                // حذف ماركر قديم
                if (miniMarker) miniMap.removeLayer(miniMarker);

                miniMarker = L.marker([service.lat, service.lng]).addTo(miniMap);

                // حذف خط قديم
                if (miniRouteLine) miniMap.removeLayer(miniRouteLine);

                // إنشاء خط بين المستخدم والوجهة
                miniRouteLine = L.polyline(
                    [
                        [userLocation.lat, userLocation.lng],
                        [service.lat, service.lng]
                    ],
                    {
                        color: '#1a73e8',
                        weight: 4,
                        opacity: 0.8
                    }
                ).addTo(miniMap);

                // ضبط عرض الخريطة ليشمل النقطتين
                const bounds = L.latLngBounds([
                    [userLocation.lat, userLocation.lng],
                    [service.lat, service.lng]
                ]);

                miniMap.fitBounds(bounds, { padding: [30, 30] });

                miniMap.invalidateSize();

            }, 200);
        }

        // وظيفة اتصال الطوارئ
        const emergencyBtn = document.getElementById('emergencyCall');
        if (emergencyBtn) {
            emergencyBtn.addEventListener('click', () => {
                const emergencyNumber = '14';
                const confirmCall = confirm(`هل تريد الاتصال برقم الطوارئ ${emergencyNumber}؟`);
                if (confirmCall) {
                    window.location.href = `tel:${emergencyNumber}`;
                }
            });
        }

        // إغلاق النافذة
        document.addEventListener("click", function (e) {

            const modal = document.getElementById("routeModal");

            if (e.target.closest(".close-modal")) {
                modal.style.display = "none";
            }

            if (e.target === modal) {
                modal.style.display = "none";
            }

        });

        // تهيئة الخريطة ببعض البيانات الافتراضية عند التحميل
        document.addEventListener('DOMContentLoaded', () => {
            const defaultLocation = { lat: 36.7525, lng: 3.0418 };
            const nearestServices = findNearestServices(defaultLocation.lat, defaultLocation.lng);
            addMarkersToMap(nearestServices);
        });

    </script>

    <script>
        // زر الطوارئ العائم

        const toggleBtn = document.getElementById("emergencyToggle");
        const menu = document.getElementById("emergencyMenu");

        toggleBtn.addEventListener("click", () => {
            menu.style.display = menu.style.display === "flex" ? "none" : "flex";
        });

        // إغلاق القائمة عند الضغط خارجها
        document.addEventListener("click", function (e) {
            if (!e.target.closest(".floating-wrapper")) {
                menu.style.display = "none";
            }
        });


        // إخفاء الهيدر

        let lastScrollTop = 0;
        const header = document.querySelector("header");

        window.addEventListener("scroll", function () {

            const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

            if (currentScroll > lastScrollTop && currentScroll > 100) {
                // النزول للأسفل
                header.classList.add("hide-header");
            } else {
                // الصعود للأعلى
                header.classList.remove("hide-header");
            }

            lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
        });

    </script>

</body>

</html>
